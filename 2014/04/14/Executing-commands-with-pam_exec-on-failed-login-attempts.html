<!DOCTYPE html>
<html>
    <head>
      <meta charset="UTF-8">
      <!-- Bootstrap -->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" media="screen" href="/css/bootstrap.min.css">
      <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
      <!-- syntax highlighting -->
      <link rel="stylesheet" href="/css/pygments/native.css">
      <!-- Overrides -->
      <link rel="stylesheet" href="/css/layout.css">
      <link rel="stylesheet" href="/css/chemistryregular.css">
      <link rel="stylesheet" href="/css/solarized-light.css">
      <link rel="stylesheet" href="/css/navtree-ascii-solarized-light.css">
      <link rel="stylesheet" href="/css/powerline-solarized-light.css">
      <link rel="icon" href="/img/favicon.ico?v=2" sizes="16x16 24x24 32x32 64x64" type="image/vnd.microsoft.icon">
      <!-- mathjax -->
      <script type="text/javascript" src="/js/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <title>Executing commands with pam_exec on failed login attempts - miscBitsOfData</title>
    </head>
    <body>

        <div class="container">
            <a href="/"><h1 class="title">// miscbitsofdata</h1></a>

            <div class="main">
                <div class="side">
		    <div class="navtree-ascii">
    <span class="nav drop">[-]&nbsp;~/<br />
	&nbsp;|~&nbsp;<a href="/">posts</a><br />
        &nbsp;|&nbsp;&nbsp;|<br />
	&nbsp;|&nbsp;&nbsp;`-<a href="/by-year">by year</a><br />
        &nbsp;|<br />
	&nbsp;|~&nbsp;odds & ends<br />
        &nbsp;|&nbsp;&nbsp;|<br />
	&nbsp;|&nbsp;&nbsp;`-<a href="/calendar/index.php">calendar</a><br />
	&nbsp;|<br />
	&nbsp;`~&nbsp;<a href="/tags/index.html">tags</a><br />
    </span>
    <span class="nav fill">
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
    </span>
</div>

                </div>
                <div class="view ">
                    <div class="content">
			<div class="post">
    <h1>Executing commands with pam_exec on failed login attempts</h1>
    <date>14 Apr 2014</date>
    
    <hr />
    <p>Thanks to <a href="http://ubuntuforums.org/archive/index.php/t-1509424.html">this post</a>.</p>

<p><code>/bin/grabpicture</code>
<figure class="code"><figcaption></figcaption>
<div class="highlight"><pre><code class="bash"><span class="c">#!/bin/bash</span>
<span class="nv">ts</span><span class="o">=</span><span class="se">`</span>date +%s<span class="sb">`</span>
ffmpeg -f video4linux2 -s vga -i /dev/video0 -vframes 3 /tmp/vid-<span class="nv">$ts</span>.%01d.jpg
<span class="nb">exit </span>0
</code></pre></div>
</figure></p>

<p>On arch, add the following to <code>/etc/pam.d/system-auth</code></p>

<figure class="code"><figcaption></figcaption>
<div class="highlight"><pre><code class="bash"><span class="c">#%PAM-1.0</span>

auth        <span class="o">[</span><span class="nv">success</span><span class="o">=</span>2 <span class="nv">default</span><span class="o">=</span>ignore<span class="o">]</span>        pam_unix.so try_first_pass nullok
auth        optional                          pam_exec.so seteuid <span class="nv">log</span><span class="o">=</span>/var/log/grabpicture /bin/grabpicture
auth        requisite                         pam_deny.so
</code></pre></div>
</figure>

<p><strong><em>TODO:</em></strong>
i3lock</p>

    <hr />

    
    <span class="random">/dev/random</span>
    <blockquote class="fortune"><pre>Oh, you think you're doing some damage? Two plus two is [static] â€¦
ten. In base four! I'm fine!
</pre></blockquote>
</div>

                    </div>
                </div>

            </div> <!-- main -->
	    <div class="powerline">
  <div class="text-left1">
    <a href="">&nbsp; mbod </a>
  </div>
  <div class="l1"></div>
  <div class="text-left2 hidden-xs hidden-sm ">Executing-commands-with-pam_exec-on-failed-login-attempts.html</div>
  <div class="l2"></div>
  <div class="git"></div>
  <div class="text-left3 hidden-xs">&nbsp;working</div>
  <div class="l3"></div>
  <div class="text-left4 hidden-xs">current</div>
  <div class="l4"></div>
  <span class=""><!-- center text --></span>
  <div class="text-right1">linux&nbsp;</div>
  <div class="r1"></div>
  <div class="text-right2 hidden-xs">programming</div>
  <div class="r2"></div>
  <div class="text-right3 hidden-xs hidden-sm">rants</div>
  <div class="r3"></div>
</div>

            <div class="footer">&copy; 2014 miscbitsofdata.com</div>
        </div><!-- container -->

      <!--  bootstrap js  -->
<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/eHeight.js"></script>
<script type="text/javascript" src="/js/aHeight.js"></script>
<!-- <script type="text/javascript" src="/js/fill.js"></script> -->

    </body>
</html>
