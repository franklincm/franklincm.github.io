<!DOCTYPE html>
<html>
    <head>
      <meta charset="UTF-8">
      <!-- Bootstrap -->
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" media="screen" href="/css/bootstrap.min.css">
      <link href="/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
      <!-- syntax highlighting -->
      <link rel="stylesheet" href="/css/pygments/native.css">
      <!-- Overrides -->
      <link rel="stylesheet" href="/css/layout.css">
      <link rel="stylesheet" href="/css/chemistryregular.css">
      <link rel="stylesheet" href="/css/solarized-light.css">
      <link rel="stylesheet" href="/css/navtree-ascii-solarized-light.css">
      <link rel="stylesheet" href="/css/powerline-solarized-light.css">
      <link rel="icon" href="/img/favicon.ico?v=2" sizes="16x16 24x24 32x32 64x64" type="image/vnd.microsoft.icon">
      <!-- mathjax -->
      <script type="text/javascript" src="/js/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <title>Prompt for and capture input in weechat - miscBitsOfData</title>
    </head>
    <body>

        <div class="container">
            <a href="/"><h1 class="title">// miscbitsofdata</h1></a>

            <div class="main">
                <div class="side">
		    <div class="navtree-ascii">
    <span class="nav drop">[-]&nbsp;~/<br />
	&nbsp;|~&nbsp;<a href="/">posts</a><br />
        &nbsp;|&nbsp;&nbsp;|<br />
	&nbsp;|&nbsp;&nbsp;`-<a href="/by-year">by year</a><br />
        &nbsp;|<br />
	&nbsp;|~&nbsp;odds & ends<br />
        &nbsp;|&nbsp;&nbsp;|<br />
	&nbsp;|&nbsp;&nbsp;`-<a href="/calendar/index.php">calendar</a><br />
	&nbsp;|<br />
	&nbsp;`~&nbsp;<a href="/tags/index.html">tags</a><br />
    </span>
    <span class="nav fill">
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
      ~<br />
    </span>
</div>

                </div>
                <div class="view ">
                    <div class="content">
			<div class="post">
    <h1>Prompt for and capture input in weechat</h1>
    <date>12 Mar 2014</date>
    
    <author>Author: <span>chase</span></author>
    
    <hr />
    <figure class="code"><figcaption></figcaption>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">weechat</span>

<span class="nb">input</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="s">&quot;Enter passphrase: &quot;</span>
<span class="n">hooks</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">hook_command_run</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;input&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="s">&quot;/input *&quot;</span><span class="p">,</span>  <span class="s">&quot;command_run_input&quot;</span><span class="p">),</span>
    <span class="s">&quot;buffer&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;/buffer *&quot;</span><span class="p">,</span> <span class="s">&quot;command_run_buffer&quot;</span><span class="p">),</span>
    <span class="s">&quot;window&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;/window *&quot;</span><span class="p">,</span> <span class="s">&quot;command_run_window&quot;</span><span class="p">),</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">input_modifier</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">modifier_data</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="k">global</span> <span class="nb">input</span><span class="p">,</span> <span class="n">prompt</span>

    <span class="k">if</span> <span class="n">modifier_data</span> <span class="o">!=</span> <span class="n">weechat</span><span class="o">.</span><span class="n">current_buffer</span><span class="p">():</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="nb">input</span> <span class="o">=</span> <span class="n">weechat</span><span class="o">.</span><span class="n">string_remove_color</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">cursor</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x19</span><span class="s">b#&#39;</span>
    <span class="c">## displays input as it is entered:</span>
    <span class="c">#return prompt + input + cursor</span>

    <span class="c">## suppress input as it is entered:</span>
    <span class="k">return</span> <span class="n">prompt</span> <span class="o">+</span> <span class="n">cursor</span>


<span class="k">def</span> <span class="nf">unhook_one</span><span class="p">(</span><span class="n">hook</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">hooks</span>
        <span class="k">if</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
            <span class="n">weechat</span><span class="o">.</span><span class="n">unhook</span><span class="p">(</span><span class="n">hooks</span><span class="p">[</span><span class="n">hook</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">hooks</span><span class="p">[</span><span class="n">hook</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">unhook_all</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">hook_command_run</span><span class="p">,</span> <span class="n">hooks</span>
    <span class="n">unhook_one</span><span class="p">(</span><span class="s">&quot;modifier&quot;</span><span class="p">)</span>
    <span class="nb">map</span><span class="p">(</span><span class="n">unhook_one</span><span class="p">,</span> <span class="n">hook_command_run</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">hook_all</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">hook_command_run</span><span class="p">,</span> <span class="n">hooks</span>

    <span class="k">for</span> <span class="n">hook</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">hook_command_run</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">hook</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
            <span class="n">hooks</span><span class="p">[</span><span class="n">hook</span><span class="p">]</span> <span class="o">=</span> <span class="n">weechat</span><span class="o">.</span><span class="n">hook_command_run</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">&quot;modifier&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hooks</span><span class="p">:</span>
        <span class="n">hooks</span><span class="p">[</span><span class="s">&quot;modifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weechat</span><span class="o">.</span><span class="n">hook_modifier</span><span class="p">(</span>
            <span class="s">&quot;input_text_display_with_cursor&quot;</span><span class="p">,</span> <span class="s">&quot;input_modifier&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">command_run_input</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="k">global</span> <span class="nb">input</span>

    <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s">&quot;/input search_text&quot;</span> <span class="ow">or</span> <span class="n">command</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;/input jump&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>

    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s">&quot;/input complete_next&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>

    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s">&quot;/input complete_previous&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>

    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s">&quot;/input return&quot;</span><span class="p">:</span>
        <span class="c">### display captured input ###</span>
        <span class="n">weechat</span><span class="o">.</span><span class="n">prnt</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;input entered: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">input</span><span class="p">))</span>

        <span class="n">unhook_all</span><span class="p">()</span>
        <span class="n">weechat</span><span class="o">.</span><span class="n">buffer_set</span><span class="p">(</span><span class="nb">buffer</span><span class="p">,</span> <span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>
    <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK</span>


<span class="k">def</span> <span class="nf">command_run_buffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function called when a command &quot;/buffer xxxx&quot; is run &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>


<span class="k">def</span> <span class="nf">command_run_window</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function called when a command &quot;/buffer xxxx&quot; is run &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">weechat</span><span class="o">.</span><span class="n">WEECHAT_RC_OK_EAT</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">weechat</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&quot;input_test&quot;</span><span class="p">,</span> <span class="s">&quot;jakhead&quot;</span><span class="p">,</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span> <span class="s">&quot;MIT&quot;</span><span class="p">,</span> <span class="s">&quot;input test&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="n">hook_all</span><span class="p">()</span>
        
</code></pre></div>
</figure>

    <hr />

    
    <p><span>Chase Franklin</span> : <a href="https://github.com/gnullbyte">github.com/gnullbyte</a><br/>
<pre class="contact">echo sjtqnjm.pvjru@lxv | tr a-z@. r-za-q.@</pre><br /></p>

    
    <span class="random">/dev/random</span>
    <blockquote class="fortune"><pre>Here, stand behind me. Yeah, just like that. Just like you're doing.
Things are about to get real messy.
</pre></blockquote>
</div>

                    </div>
                </div>

            </div> <!-- main -->
	    <div class="powerline">
  <div class="text-left1">
    <a href="">&nbsp; mbod </a>
  </div>
  <div class="l1"></div>
  <div class="text-left2 hidden-xs hidden-sm ">Prompt-for-and-capture-input-in-weechat.html</div>
  <div class="l2"></div>
  <div class="git"></div>
  <div class="text-left3 hidden-xs">&nbsp;working</div>
  <div class="l3"></div>
  <div class="text-left4 hidden-xs">current</div>
  <div class="l4"></div>
  <span class=""><!-- center text --></span>
  <div class="text-right1">linux&nbsp;</div>
  <div class="r1"></div>
  <div class="text-right2 hidden-xs">programming</div>
  <div class="r2"></div>
  <div class="text-right3 hidden-xs hidden-sm">rants</div>
  <div class="r3"></div>
</div>

            <div class="footer">&copy; 2014 miscbitsofdata.com</div>
        </div><!-- container -->

      <!--  bootstrap js  -->
<script type="text/javascript" src="/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/eHeight.js"></script>
<script type="text/javascript" src="/js/aHeight.js"></script>
<!-- <script type="text/javascript" src="/js/fill.js"></script> -->

    </body>
</html>
